<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>
			{% block title %}Welcome!
			{% endblock %}
		</title>
		<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text></svg>">
		{# Run `composer require symfony/webpack-encore-bundle` to start using Symfony UX #}
		<!-- Font Awesome -->
		<link
		rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/> <!-- Google Fonts Roboto -->
		<link
		rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"/>
		<!-- MDB ESSENTIAL -->
		<link rel="stylesheet" href="/css/mdb.min.css"/>
		<!-- MDB PLUGINS -->
		{# <link
				rel="stylesheet" href="/css/mdb-plugins.min.css"/> #}
		<link
		rel="stylesheet" href="/plugins/css/all.min.css"/> <!-- Custom styles -->
		<link rel="stylesheet" href="/css/style.css"/>
	</head>
	<body>
		{% include "components/navbar.html.twig" %}
		<div class="container"> {% block body %}{% endblock %}
			</div>

			<!-- MDB ESSENTIAL -->
			<script type="text/javascript" src="/js/mdb.min.js"></script>
			<!-- MDB PLUGINS -->
			<script type="text/javascript" src="/plugins/js/all.min.js"></script>
			<script>
				const eventSource = new EventSource("{{ mercure('https://localhost/users/' ~ app.user.id ~ '/messages')|escape('js') }}");
				console.log(eventSource);
				eventSource.onmessage = event => { // Will be called every time an update is published by the server
				console.log(JSON.parse(event.data));
				const data = JSON.parse(event.data);
				const element = document.getElementById("message-box");
				console.log(element);

				const uri = '/users/' + {{app.user.id}};
				console.log(uri);
				const date = (new Date(data.createdAt)).toUTCString();
				console.log(date);
				
				const template = document.createElement('template');
				template.innerHTML = ` <div class="d-flex justify-content-between">
			<p class="small mb-1">${data.sent.username}</p>
			<p class="small mb-1 text-muted">${date}</p>
            </div>
            <div class="d-flex flex-row justify-content-${data.sent.id === uri ? "start":"end" } received">
              <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava5-bg.webp"
                alt="avatar 1" style="width: 45px; height: 100%;">
              <div>
                <p class="small p-2 ms-3 mb-3 rounded-3" style="background-color: #f5f6f7;">${data.content}</p>
              </div>
            </div>`;
			element.appendChild(template.content);
				}
						function sendMessage() {
  var inputField = document.getElementById("message-input");
  var message = inputField.value;

  // Get the username and date
  var username = "{{ app.user.username }}"; // Replace with the actual username value
  var currentDate = new Date().toUTCString();

  // Example: Append the message and other data to the message-box
  var messageBox = document.getElementById("message-box");
  var template = document.createElement('template');
  template.innerHTML = `
    <div class="d-flex justify-content-between">
      <p class="small mb-1">${username}</p>
      <p class="small mb-1 text-muted">${currentDate}</p>
    </div>
    <div class="d-flex flex-row justify-content-end received">
      <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava5-bg.webp" alt="avatar 1" style="width: 45px; height: 100%;">
      <div>
        <p class="small p-2 ms-3 mb-3 rounded-3" style="background-color: #f5f6f7;">${message}</p>
      </div>
    </div>`;

  messageBox.appendChild(template.content);
console.log(uri);
  // Clear the input field after sending the message
  inputField.value = "";
}

			</script>

			
		</body>
	</html>
